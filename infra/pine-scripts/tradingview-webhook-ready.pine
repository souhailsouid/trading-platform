//@version=6
indicator(title="Webhook Alert â€“ RSI, MACD, Stoch", shorttitle="Webhook", overlay=true)

// âš™ï¸ Configuration du seuil RSI
rsiThreshold = input.float(30.0, "RSI Threshold", minval=0, maxval=100, step=0.1)

// ğŸ“Š RSI (Relative Strength Index)
rsi = ta.rsi(close, 14)
plot(rsi, "RSI", color=color.purple, linewidth=2) // plot_0

// ğŸ“ˆ Stochastique %K
stoch_k = ta.sma(ta.stoch(close, high, low, 14), 1)
plot(stoch_k, "Stoch %K", color=color.blue, linewidth=1) // plot_1

// ğŸ“‰ MACD Histogram
[macd_val, macd_signal, macd_hist] = ta.macd(close, 12, 26, 9)
plot(macd_hist, "MACD Histogram", style=plot.style_histogram, color=color.green) // plot_2
plot(macd_val, "MACD", color=color.blue, linewidth=1) // plot_3
plot(macd_signal, "MACD Signal", color=color.red, linewidth=1) // plot_4

// ğŸ“Š Stochastique %D
stoch_d = ta.sma(stoch_k, 3)
plot(stoch_d, "Stoch %D", color=color.orange, linewidth=1) // plot_5

// ğŸ¯ Condition d'alerte : RSI < seuil
alertCondition = rsi < rsiThreshold

// ğŸ“¨ Message JSON pour le webhook
// âš ï¸ IMPORTANT : Copie ce message EXACTEMENT dans TradingView
// Les valeurs numÃ©riques sont SANS guillemets pour que TradingView les envoie comme nombres
// Si une valeur est na (non disponible), TradingView enverra NaN qui sera converti en null cÃ´tÃ© Lambda
webhookMessage = '{"symbol":"{{ticker}}","price":{{close}},"time":"{{time}}","indicators":{"rsi":{{plot_0}},"macd":{"macd":{{plot_3}},"signal":{{plot_4}},"histogram":{{plot_2}}},"stoch":{"k":{{plot_1}},"d":{{plot_5}}}}}'

// ğŸš¨ CrÃ©er l'alerte
alertcondition(
  alertCondition, 
  title="Webhook Trading Alert (RSI)", 
  message=webhookMessage
)

// ğŸ“Š Affichage visuel
bgcolor(alertCondition ? color.new(color.red, 90) : na, title="RSI Alert Background")

// ğŸ“ Labels d'information
if alertCondition and barstate.islast
    label.new(bar_index, high, 
        text="âš ï¸ RSI Alert\nRSI: " + str.tostring(rsi, "#.##") + "\nPrice: " + str.tostring(close, "#.##"), 
        color=color.red, 
        textcolor=color.white, 
        style=label.style_label_down)

